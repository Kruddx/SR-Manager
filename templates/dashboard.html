{% extends "base.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥ - SR-Manager{% endblock %}

{% block content %}
<div class="card">
    <h1>üìä –î–∞—à–±–æ—Ä–¥ - –í–∞—à–∏ —Ä–µ–π–¥—ã</h1>
    <p>–ü—Ä–∏–≤–µ—Ç, {{ user.discord_username }}! –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.</p>
    
    <div style="margin: 30px 0; display: flex; gap: 15px; flex-wrap: wrap;">
        <a href="/upload" class="btn btn-success">+ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ä–µ–π–¥</a>
        <a href="/generate" class="btn btn-secondary">üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JSON</a>
    </div>
</div>

<div class="card">
    {% if raids %}
        <h2>–ò—Å—Ç–æ—Ä–∏—è —Ä–µ–π–¥–æ–≤ ({{ raids|length }})</h2>
        <div class="grid">
            {% for raid in raids %}
            <div class="card" style="position: relative;">
                <h3>üéØ –†–µ–π–¥ –æ—Ç {{ raid.date.strftime('%d.%m.%Y') }}</h3>
                <p><strong>Instances:</strong> {{ raid.instances }}</p>
                <p><strong>–ó–∞–≥—Ä—É–∂–µ–Ω–æ:</strong> {{ raid.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                <button class="btn btn-danger" onclick="deleteRaid({{ raid.id }})" 
                        style="position: absolute; top: 20px; right: 20px;">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px;">
            <h3>üì≠ –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–µ–π–¥–æ–≤</h3>
            <p>–ù–∞—á–Ω–∏—Ç–µ —Å –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—à–∏—Ö –ø–µ—Ä–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</p>
            <a href="/upload" class="btn btn-success" style="margin-top: 20px;">
                üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </a>
        </div>
    {% endif %}
</div>

<script>
function deleteRaid(raidId) {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–π–¥?')) {
        fetch(`/raid/${raidId}/delete`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + data.error);
            }
        })
        .catch(error => {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error);
        });
    }
}
</script>
{% endblock %}